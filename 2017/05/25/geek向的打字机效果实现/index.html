<!DOCTYPE html><html lang="zh-cmn-Hans"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> geek向的打字机效果实现 · Ken's Blog － 黄凯羿的个人博客，分享javascript,前端开发,设计和生活。</title><meta name="description" content="geek向的打字机效果实现 - Ken Huang"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">博客</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">分类</a></li><li class="nav-list-item"><a href="http://weibo.com/witnesswithyou" target="_blank" class="nav-list-link">微博</a></li><li class="nav-list-item"><a href="https://github.com/kenhky" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="http://www.huangkaiyi.com" target="_blank" class="nav-list-link">主页</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">geek向的打字机效果实现</h1><div class="post-time">May 25, 2017</div><div class="post-content"><p>css 揭秘这本书买了好久了，一直没有看完。趁着有空翻了一遍，有一个效果吸引到了我，就是类似终端的打字机效果。</p>
<p>要实现这个效果，最简单的就是用 javascript setInterval 来不断改变字符串的位数来实现。</p>
<p><img src="http://7xtb3a.com2.z0.glb.clouddn.com/type-writer.gif" alt=""></p>
<p>比如： </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">typewriter</span> (<span class="params">typeDom</span>) </span>&#123;</div><div class="line">	<span class="keyword">var</span> n = <span class="number">0</span>;</div><div class="line">	<span class="keyword">var</span> text = typeDom.textContent;</div><div class="line">	<span class="comment">// 初始内容设空</span></div><div class="line">	typeDom.innerHTML = <span class="string">''</span>;</div><div class="line">	<span class="comment">// setInterval 改变字符串的位数</span></div><div class="line">	<span class="keyword">var</span> print = setInterval(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">	  n += <span class="number">1</span>;</div><div class="line">	  typeDom.innerHTML = text.substring(<span class="number">0</span>, n);</div><div class="line">	  <span class="keyword">if</span> (n === text.length) &#123;</div><div class="line">			<span class="built_in">window</span>.clearInterval(print);</div><div class="line">		&#125;</div><div class="line">	&#125;, <span class="number">200</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">var</span> typist = <span class="built_in">document</span>.querySelectorAll(<span class="string">".typist"</span>);</div><div class="line">typewriter(typist[<span class="number">0</span>])</div></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">"typist"</span>&gt;</span>你好，这是一个打字效果动画<span class="tag">&lt;/<span class="name">p</span>&gt;</span></div></pre></td></tr></table></figure>
<p>动画效果归根结底是表现层的，那能不能直接用 css 实现呢？答案是可以的。</p>
<p>首先让文字从无到有，大家都能想到用 animation :</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">@<span class="keyword">keyframes</span> typing &#123;</div><div class="line">  <span class="selector-tag">from</span> &#123; <span class="attribute">width</span>: <span class="number">0</span> &#125;</div><div class="line">&#125;</div><div class="line"><span class="selector-class">.typist</span> &#123;</div><div class="line">  <span class="attribute">width</span>: <span class="number">13em</span>; <span class="comment">/* 文本宽度 */</span></div><div class="line">  <span class="attribute">animation</span>: typing <span class="number">6s</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;p <span class="class"><span class="keyword">class</span></span>=<span class="string">"typist"</span>&gt;你好，这是一个打字效果动画&lt;<span class="regexp">/p&gt;</span></div></pre></td></tr></table></figure>
<p><img src="http://7xtb3a.com2.z0.glb.clouddn.com/type-writer-wrong.gif" alt=""></p>
<p>这样实现有几个问题。</p>
<ol>
<li>文本未折行。</li>
<li>动画不是一个一个文字出来的，而是平滑连贯的。</li>
<li>没有光标。</li>
<li>在中文等宽字体中可以直接用em，英文怎么算宽度？</li>
</ol>
<p>我们一个一个解决：</p>
<p>第一个问题加上 <code>white-space: nowrap;</code>和<code>overflow: hidden;</code>就可以了。</p>
<p>第二个问题需要用到 css 动画的 animation-timing-function 这个属性。这个属性规定动画的速度曲线，其中提供了一个 steps() 函数来实现切割动画。 steps() 通过你传入的步骤数来切割动画，类似于幻灯片一样而不是默认平滑的效果。比如 steps(6) 就表示这个动画有6步。这个属性可以直接写到 animation 简写里，我们可以把上面的属性改写成：animation: typing 6s steps(13);</p>
<p>这两个问题解决了以后我们打字动画的雏形就已经完成了，完整 css 如下：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">@<span class="keyword">keyframes</span> typing &#123;</div><div class="line">  <span class="selector-tag">from</span> &#123; <span class="attribute">width</span>: <span class="number">0</span> &#125;</div><div class="line">&#125;</div><div class="line"><span class="selector-class">.typist</span> &#123;</div><div class="line">  <span class="attribute">width</span>: <span class="number">13em</span>; <span class="comment">/* 文本宽度 */</span></div><div class="line">  <span class="attribute">white-space</span>: nowrap;</div><div class="line">  <span class="attribute">overflow</span>: hidden;</div><div class="line">  <span class="attribute">animation</span>: typing <span class="number">4s</span> <span class="built_in">steps</span>(13);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>想要效果逼真的话还需要加上闪烁的光标。加光标的话就很容易了,直接改 border-right-color 就可以了：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">@<span class="keyword">keyframes</span> caret &#123;</div><div class="line">	50% &#123; <span class="attribute">border-right-color</span>: inherit; &#125;</div><div class="line">&#125;</div><div class="line">@<span class="keyword">keyframes</span> typing &#123;</div><div class="line">  <span class="selector-tag">from</span> &#123; <span class="attribute">width</span>: <span class="number">0</span> &#125;</div><div class="line">&#125;</div><div class="line"><span class="selector-class">.typist</span> &#123;</div><div class="line">  <span class="attribute">width</span>: <span class="number">13em</span>; <span class="comment">/* 文本宽度 */</span></div><div class="line">  <span class="attribute">white-space</span>: nowrap;</div><div class="line">  <span class="attribute">overflow</span>: hidden;</div><div class="line">  <span class="attribute">border-right</span>: .<span class="number">05em</span> solid transparent;</div><div class="line">  <span class="attribute">animation</span>: typing <span class="number">4s</span> <span class="built_in">steps</span>(13),</div><div class="line">						  caret <span class="number">1s</span> <span class="built_in">steps</span>(1) infinite;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><img src="http://7xtb3a.com2.z0.glb.clouddn.com/type-writer-true.gif" alt=""></p>
<p>至此动画已经很完善了。还剩最后一个问题：中文用 em 就能计算文字宽度，英文呢？其实在 css 中有许多不太常见的单位，比如：ch。在 MDN 文档中的解释：Represents the width, or more precisely the advance measure, of the glyph ‘0’ (zero, the Unicode character U+0030) in the element’s font. 意思是表示“0”字形的宽度。这个奇怪的单位在英文等宽字体中巧妙的解决了我们的问题，因为在等宽字体中，“0”字形的宽度和其他所有字形的宽度是一样的。</p>
<p>在定义英文字体的时候，我们需要找一个等宽字体，比如：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">@<span class="keyword">import</span> url(http://fonts.googleapis.com/css?family=Anonymous+Pro);</div><div class="line"><span class="selector-tag">body</span> &#123; <span class="attribute">font-family</span>: <span class="string">'Anonymous Pro'</span>, monospace; &#125;</div></pre></td></tr></table></figure>
<p>这样我们中文，英文都可以实现打字机效果啦！<br>github: <a href="https://github.com/KenHky/type-writer" target="_blank" rel="external">https://github.com/KenHky/type-writer</a></p>
</div></article></div></section><footer><div class="paginator"><a href="/2016/11/01/前端从入门到再次入门 - 异步/" class="next">NEXT</a></div><div class="copyright"><p>© 2016 - 2017 <a href="http://www.huangkaiyi.me">Ken Huang</a> 粤ICP备15066407号 邮箱:ken.hky@163.com</p></div></footer></div><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-65933410-1",'auto');ga('send','pageview');</script><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML"></script></body></html>